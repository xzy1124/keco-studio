name: Sync to Personal Repository

on:
  push:
    branches:
      - main

jobs:
  sync-to-personal:
    runs-on: ubuntu-latest

    # åªå…è®¸åœ¨å›¢é˜Ÿä»“åº“è¿è¡Œ
    if: github.repository == 'Caerulean-ai/keco-studio'

    permissions:
      contents: write

    steps:
      - name: Checkout main
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Set up Git
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"

      - name: Push main to personal repo
        env:
          PERSONAL_GITHUB_TOKEN: ${{ secrets.PERSONAL_GITHUB_TOKEN }}
        run: |
          if [ -z "${PERSONAL_GITHUB_TOKEN}" ]; then
            echo "âŒ PERSONAL_GITHUB_TOKEN not set"
            exit 1
          fi

          PERSONAL_REPO_URL="https://x-access-token:${PERSONAL_GITHUB_TOKEN}@github.com/xzy1124/keco-studio.git"

          echo "ğŸš€ Syncing main to personal repo..."
          echo "ğŸ“ Commit: $(git rev-parse HEAD)"
          echo "ğŸ“ Message: $(git log -1 --pretty=%B)"

          git push "${PERSONAL_REPO_URL}" main:refs/heads/main --force

          echo "âœ… Synced to personal repository (main)"
